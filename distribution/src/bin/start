#!/usr/bin/env bash

echo "当前Home目录："$PWD



echo "开启 opensearch 和 cassandra -----------------------"
echo "正在开启中......"
source "`dirname "$1"`"/cassandra/bin/cassandra &
sleep 60

result="`dirname "$1"`"/cassandra/bin/nodetool
ret=1
while [ $ret == 1 ]
do
  echo "正在检测 Cassandra 服务状态。。。。。。"
  sh $result "status"
  ret=$?
done


num2=`ps -ef | grep 'cassandra' | grep -v grep | wc -l`

if [ $num2 -eq 0 ]; then
   echo "cassandra 启动失败......"
   exit
fi
sleep 15
echo "进程检测完毕，cassandra 启动成功......."


source "`dirname "$0"`"/opensearch -d &
sleep 20

num1=`ps -ef | grep 'opensearch' | grep -v grep | wc -l`

if [ $num1 -eq  0 ]; then  #如果没有该进程，则退出
  echo "opensearch 启动失败......"
  exit
fi
sleep 5
echo "进程检测完毕，opensearch 启动成功......."
